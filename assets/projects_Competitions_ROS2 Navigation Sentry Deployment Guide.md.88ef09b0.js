import{_ as s,c as a,o as n,d as o}from"./app.ea974651.js";const A=JSON.parse('{"title":"ROS2 Navigation Sentry Deployment Guide","description":"","frontmatter":{},"headers":[{"level":2,"title":"1 Dependencies","slug":"_1-dependencies","link":"#_1-dependencies","children":[{"level":3,"title":"1.1 livox_sdk2","slug":"_1-1-livox-sdk2","link":"#_1-1-livox-sdk2","children":[]},{"level":3,"title":"1.2 Third Packages","slug":"_1-2-third-packages","link":"#_1-2-third-packages","children":[]},{"level":3,"title":"1.3 navigation2 (ros2 navigation)","slug":"_1-3-navigation2-ros2-navigation","link":"#_1-3-navigation2-ros2-navigation","children":[]},{"level":3,"title":"1.4 sentry_serial_node","slug":"_1-4-sentry-serial-node","link":"#_1-4-sentry-serial-node","children":[]},{"level":3,"title":"1.5 Pointcloud to Laserscan","slug":"_1-5-pointcloud-to-laserscan","link":"#_1-5-pointcloud-to-laserscan","children":[]}]},{"level":2,"title":"2 Tuning and Configuration Guide","slug":"_2-tuning-and-configuration-guide","link":"#_2-tuning-and-configuration-guide","children":[{"level":3,"title":"2.1 FAST_LIO","slug":"_2-1-fast-lio","link":"#_2-1-fast-lio","children":[]},{"level":3,"title":"2.2 Sentry Description","slug":"_2-2-sentry-description","link":"#_2-2-sentry-description","children":[]},{"level":3,"title":"2.3 Navigation","slug":"_2-3-navigation","link":"#_2-3-navigation","children":[]}]},{"level":2,"title":"3 Map","slug":"_3-map","link":"#_3-map","children":[{"level":3,"title":"3.1 Make and Save a Map","slug":"_3-1-make-and-save-a-map","link":"#_3-1-make-and-save-a-map","children":[]},{"level":3,"title":"3.2 The Projection from Actual Map and Referee System","slug":"_3-2-the-projection-from-actual-map-and-referee-system","link":"#_3-2-the-projection-from-actual-map-and-referee-system","children":[]}]}],"relativePath":"projects/Competitions/ROS2 Navigation Sentry Deployment Guide.md","lastUpdated":1693377409000}'),l={name:"projects/Competitions/ROS2 Navigation Sentry Deployment Guide.md"},e=o(`<h1 id="ros2-navigation-sentry-deployment-guide" tabindex="-1">ROS2 Navigation Sentry Deployment Guide <a class="header-anchor" href="#ros2-navigation-sentry-deployment-guide" aria-hidden="true">#</a></h1><nav class="table-of-contents"><ul><li><a href="#_1-dependencies">1 Dependencies</a><ul><li><a href="#_1-1-livox-sdk2">1.1 livox_sdk2</a></li><li><a href="#_1-2-third-packages">1.2 Third Packages</a></li><li><a href="#_1-3-navigation2-ros2-navigation">1.3 navigation2 (ros2 navigation)</a></li><li><a href="#_1-4-sentry-serial-node">1.4 sentry_serial_node</a></li><li><a href="#_1-5-pointcloud-to-laserscan">1.5 Pointcloud to Laserscan</a></li></ul></li><li><a href="#_2-tuning-and-configuration-guide">2 Tuning and Configuration Guide</a><ul><li><a href="#_2-1-fast-lio">2.1 FAST_LIO</a></li><li><a href="#_2-2-sentry-description">2.2 Sentry Description</a></li><li><a href="#_2-3-navigation">2.3 Navigation</a></li></ul></li><li><a href="#_3-map">3 Map</a><ul><li><a href="#_3-1-make-and-save-a-map">3.1 Make and Save a Map</a></li><li><a href="#_3-2-the-projection-from-actual-map-and-referee-system">3.2 The Projection from Actual Map and Referee System</a></li></ul></li></ul></nav><h2 id="_1-dependencies" tabindex="-1">1 Dependencies <a class="header-anchor" href="#_1-dependencies" aria-hidden="true">#</a></h2><blockquote><p>There&#39;re no <code>rosdep</code> commands because building from source is recommended.</p></blockquote><h3 id="_1-1-livox-sdk2" tabindex="-1">1.1 livox_sdk2 <a class="header-anchor" href="#_1-1-livox-sdk2" aria-hidden="true">#</a></h3><p>Follow the official guide.</p><p><a href="https://github.com/Livox-SDK/Livox-SDK2" target="_blank" rel="noreferrer">livox sdk github</a></p><h3 id="_1-2-third-packages" tabindex="-1">1.2 Third Packages <a class="header-anchor" href="#_1-2-third-packages" aria-hidden="true">#</a></h3><p>Third packages are included in our gitlab project due to stability issues. Don&#39;t use the official packages.</p><p>We have made some changes from the original packages.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://mirrors.sustech.edu.cn/git/artinx/third_package.git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--branch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">develop</span></span>
<span class="line"></span></code></pre></div><h4 id="_1-2-1-livox-ros-driver2" tabindex="-1">1.2.1 livox_ros_driver2 <a class="header-anchor" href="#_1-2-1-livox-ros-driver2" aria-hidden="true">#</a></h4><p>Go to package directory and build it using the <code>build.sh</code> script.</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#82AAFF;">.</span><span style="color:#FFCB6B;">/build.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ROS2</span></span>
<span class="line"></span></code></pre></div><p>After which, go to workspace directory and use <code>colcon build --symlink-install</code> to build the whole packages.</p><p>Next, you have to set up static ip for mid-360.Follow the instructions on the <a href="https://terra-1-g.djicdn.com/65c028cd298f4669a7f0e40e50ba1131/Download/update/Livox%20Mid%20Series%20User%20Manual%20(CN).pdf" target="_blank" rel="noreferrer">manual</a>. When you are connected to mid-360, its route would be located at <code>192.168.1.xx</code>. Set up your ethernets&#39; ip to <code>192.168.1.xx</code> as well(Follow the instructions on this <a href="https://blog.csdn.net/hahalim/article/details/129414327" target="_blank" rel="noreferrer">guide</a>)</p><p>If you want to connect to lidar on-boot, use <code>netplan</code> to do the job. However, using <code>netplan</code> would unable the remote-desktop function. Adding a router to distribute the ip would be a solution, but was not tried yet.</p><p>To learn more about mid-360, go to <a href="https://livox-wiki-cn.readthedocs.io/zh_CN/latest/tutorials/new_product/mid360/mid360.html" target="_blank" rel="noreferrer">inofficial mid-360 doc site</a>.</p><h4 id="_1-2-2-fast-lio" tabindex="-1">1.2.2 Fast lio <a class="header-anchor" href="#_1-2-2-fast-lio" aria-hidden="true">#</a></h4><p><a href="https://github.com/hku-mars/FAST_LIO" target="_blank" rel="noreferrer">Fast-lio Github</a></p><p><code>Fast-lio</code> is an odometry predicting algorithm combining IMU and point cloud data. Basically, if you can get the odometry, you can do SLAM(Simultaneously Localization and Mapping) easily.</p><p>To completely understand what SLAM is, I recommend you to read through <a href="https://github.com/qomo/LearnSensorFusion/blob/master/books/%E8%A7%86%E8%A7%89slam%E5%8D%81%E5%9B%9B%E8%AE%B2.pdf" target="_blank" rel="noreferrer">this book</a> written by Bo Gao.</p><p><code>Fast-lio</code> is broadcasting several msgs. <code>/odometry</code>, <code>/real_odometry</code> and <code>/cloud_registered</code>. <code>/odometry</code> is a stamped msg, showing the position relative to the initial position of lidar.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Mid-360 take the pose of the lidar base when initialized as the the horizon plane of its axis. This will cause some problems but somehow solved by little tricks.</p></div><p>We&#39;re using fast-lio for ROS2, which is not officially supported. Compared to ROS1, the map accumulating function(save as a map) is not accomplished yet.</p><h3 id="_1-3-navigation2-ros2-navigation" tabindex="-1">1.3 navigation2 (ros2 navigation) <a class="header-anchor" href="#_1-3-navigation2-ros2-navigation" aria-hidden="true">#</a></h3><p><a href="https://github.com/ros-planning/navigation2" target="_blank" rel="noreferrer">navigation2 github</a></p><p>Navigation is a huge project related to mountains of researches.</p><p>Building from source is recommended. Follow the official guide.</p><h3 id="_1-4-sentry-serial-node" tabindex="-1">1.4 sentry_serial_node <a class="header-anchor" href="#_1-4-sentry-serial-node" aria-hidden="true">#</a></h3><p><code>sentry_serial_node</code> is based on chenjun&#39;s RV framework, responsible for communicating with the lower computer.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>We&#39;re controlling gimbal to navigate in RMUC2023 due to differential control method. We would change that to controlling chassis in next season.</p></div><h3 id="_1-5-pointcloud-to-laserscan" tabindex="-1">1.5 Pointcloud to Laserscan <a class="header-anchor" href="#_1-5-pointcloud-to-laserscan" aria-hidden="true">#</a></h3><p>Pointcloud to laserscan is for 2d AMCL. The input is pointcloud msg /<code>cloud_registered</code> and the output is laser scan msg<code>/scan</code>.</p><h2 id="_2-tuning-and-configuration-guide" tabindex="-1">2 Tuning and Configuration Guide <a class="header-anchor" href="#_2-tuning-and-configuration-guide" aria-hidden="true">#</a></h2><div class="language-flow"><button title="Copy Code" class="copy"></button><span class="lang">flow</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">\`\`\`flow</span></span>
<span class="line"><span style="color:#A6ACCD;">st=&gt;start: Begin</span></span>
<span class="line"><span style="color:#A6ACCD;">io_livox=&gt;inputoutput: IMU+Lidar Msgs Input</span></span>
<span class="line"><span style="color:#A6ACCD;">io_serial_in=&gt;inputoutput: Serial Input</span></span>
<span class="line"><span style="color:#A6ACCD;">target=&gt;operation: Goal</span></span>
<span class="line"><span style="color:#A6ACCD;">target_cond=&gt;condition: Check if there&#39;s a Goal</span></span>
<span class="line"><span style="color:#A6ACCD;">fast_lio=&gt;operation: Fast_lio</span></span>
<span class="line"><span style="color:#A6ACCD;">point_cloud_msg=&gt;operation: Filtered Pointcloud and Odometry</span></span>
<span class="line"><span style="color:#A6ACCD;">costmap=&gt;operation: Local Costmap &amp; Global Costmap,Pointcloud to LaserScan &amp; AMCL</span></span>
<span class="line"><span style="color:#A6ACCD;">global_path=&gt;operation: Global Path (by navfn or hybrid A*)</span></span>
<span class="line"><span style="color:#A6ACCD;">controller=&gt;operation: Controller(Differential)</span></span>
<span class="line"><span style="color:#A6ACCD;">io_serial_out=&gt;inputoutput: Serial Output</span></span>
<span class="line"><span style="color:#A6ACCD;">ui_position=&gt;operation: Position In RMUC Map</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">st(bottom)-&gt;io_livox-&gt;fast_lio-&gt;point_cloud_msg-&gt;costmap-&gt;io_serial_in-&gt;target_cond(yes)-&gt;global_path-&gt;controller-&gt;io_serial_out(left)-&gt;fast_lio(left)</span></span>
<span class="line"><span style="color:#A6ACCD;">target_cond(no)-&gt;fast_lio(top)</span></span>
<span class="line"><span style="color:#A6ACCD;">\`\`\`</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><h3 id="_2-1-fast-lio" tabindex="-1">2.1 FAST_LIO <a class="header-anchor" href="#_2-1-fast-lio" aria-hidden="true">#</a></h3><p>In <code>config/mid360.yaml</code>,</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">preprocess</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">blind</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.5</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">lidar_type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;"># 1 for Livox serials LiDAR, 2 for Velodyne LiDAR, 3 for ouster LiDAR, </span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">scan_line</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">4</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">timestamp_unit</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#F07178;">scan_rate</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span></span>
<span class="line"></span></code></pre></div><p><code>blind</code> is the distant from the lidar origin to the valid data sphere.</p><h3 id="_2-2-sentry-description" tabindex="-1">2.2 Sentry Description <a class="header-anchor" href="#_2-2-sentry-description" aria-hidden="true">#</a></h3><p>The <code>tf</code> information is concluded in a <code>urdf</code> file. Change the configuration if you want to change the position of lidar on your robot.</p><h3 id="_2-3-navigation" tabindex="-1">2.3 Navigation <a class="header-anchor" href="#_2-3-navigation" aria-hidden="true">#</a></h3><p><a href="https://navigation.ros.org/configuration/index.html" target="_blank" rel="noreferrer">Official Configuration Guide</a></p><h4 id="_2-3-1-amcl" tabindex="-1">2.3.1 AMCL <a class="header-anchor" href="#_2-3-1-amcl" aria-hidden="true">#</a></h4><p>AMCL is for relocalization, adjusting the tf between the initial pose of the odometry and</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">amcl</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">ros__parameters</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">alpha1</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">alpha2</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">alpha3</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">alpha4</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">alpha5</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">robot_model_type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nav2_amcl::DifferentialMotionModel</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#F78C6C;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">tf_broadcast</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"></span></code></pre></div><p><code>alphaX</code> are the estimation of noise level of your odomtry system, each representing the translational or angular noise.<a href="https://assets.researchsquare.com/files/rs-225880/v1_covered.pdf?c=1631856303" target="_blank" rel="noreferrer">Further Tuning Guide</a></p><p>Since we&#39;re using a really precise odomtry system, we would like to set the all 5 alphas to <code>0.0005</code> . If you don&#39;t want to use relocalization, set <code>tf_broadcast</code> to <code>false</code>, and use another node to broadcast the <code>tf</code> relationship between the <code>odom</code> and <code>map</code>.</p><h4 id="_2-3-2-controller-dwb" tabindex="-1">2.3.2 Controller (DWB) <a class="header-anchor" href="#_2-3-2-controller-dwb" aria-hidden="true">#</a></h4><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">controller_server</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">ros__parameters</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">controller_frequency</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20.0</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">min_x_velocity_threshold</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.001</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">min_y_velocity_threshold</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.5</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">min_theta_velocity_threshold</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.001</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">failure_tolerance</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.3</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">...</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">general_goal_checker</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">stateful</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">plugin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nav2_controller::SimpleGoalChecker</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">xy_goal_tolerance</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.25</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">yaw_goal_tolerance</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.25</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;"># DWB parameters</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">FollowPath</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">plugin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dwb_core::DWBLocalPlanner</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">debug_trajectory_details</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">min_vel_x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">min_vel_y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">max_vel_x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.26</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">max_vel_y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">max_vel_theta</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">min_speed_xy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">max_speed_xy</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.26</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">min_speed_theta</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">acc_lim_x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2.5</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">acc_lim_y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">acc_lim_theta</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3.2</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">decel_lim_x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">-2.5</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">decel_lim_y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">decel_lim_theta</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">-3.2</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">vx_samples</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">vy_samples</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">vtheta_samples</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">20</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">sim_time</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1.7</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">linear_granularity</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.05</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">angular_granularity</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.025</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">transform_tolerance</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.2</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">xy_goal_tolerance</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.25</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F78C6C;">...</span></span>
<span class="line"></span></code></pre></div><p>Either using differential or omnidirectional controller is determined on your parameters. Becareful not to set the yaw value to zero or the controller server would collapse. Rest of the parameters are trivial according to their names.</p><h4 id="_2-3-3-costmap" tabindex="-1">2.3.3 Costmap <a class="header-anchor" href="#_2-3-3-costmap" aria-hidden="true">#</a></h4><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#F07178;">local_costmap</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">local_costmap</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">ros__parameters</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">update_frequency</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">5.0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">publish_frequency</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2.0</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">global_frame</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">odom</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">robot_base_frame</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">base_link</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">rolling_window</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">width</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">resolution</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.05</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">robot_radius</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.22</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">voxel_layer</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">inflation_layer</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">inflation_layer</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">plugin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nav2_costmap_2d::InflationLayer</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">cost_scaling_factor</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3.0</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">inflation_radius</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.55</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">voxel_layer</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">plugin</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nav2_costmap_2d::VoxelLayer</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">enabled</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">publish_voxel_map</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">origin_z</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">z_resolution</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.05</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">z_voxels</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">max_obstacle_height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2.0</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">mark_threshold</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">observation_sources</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">scan</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">scan</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">topic</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/scan</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">max_obstacle_height</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2.0</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">clearing</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">marking</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">data_type</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">LaserScan</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">raytrace_max_range</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3.0</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">raytrace_min_range</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">obstacle_max_range</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2.5</span></span>
<span class="line"><span style="color:#A6ACCD;">          </span><span style="color:#F07178;">obstacle_min_range</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.0</span></span>
<span class="line"></span></code></pre></div><p><code>robot_radius</code> can be changed to <code>footprint</code> for square robot chassis. <a href="https://navigation.ros.org/configuration/packages/configuring-costmaps.html" target="_blank" rel="noreferrer">Checkt this</a> for further information.</p><p><code>raytrace_range</code> should conclude the <code>obstacle_range</code> in order to rapidly remove the trace of the dynamic obstacle.</p><p>Because we&#39;re using pointcloud to get costmap, change the datatype and topic under <code>scan</code>.</p><p><code>global_costmap</code> is same as the <code>local_costmap</code>, presenting information for <code>path</code> calculation.</p><h2 id="_3-map" tabindex="-1">3 Map <a class="header-anchor" href="#_3-map" aria-hidden="true">#</a></h2><h3 id="_3-1-make-and-save-a-map" tabindex="-1">3.1 Make and Save a Map <a class="header-anchor" href="#_3-1-make-and-save-a-map" aria-hidden="true">#</a></h3><p><strong>Save a 3D map and project it to make a 2D map</strong></p><p>In fast-lio, change the save map parameter from false to true, you will get a 3D pcd file. Then, using <code>pcd2pgm</code> <a href="https://github.com/Hinson-A/pcd2pgm_package" target="_blank" rel="noreferrer">link</a> you can get a 2D map you like.</p><p><strong>Save a 2D map using <code>/scan</code> and gmapping</strong></p><p>Using <code>gmapping</code> and our <code>/scan</code> topic, you can save a map using map_saver.</p><h3 id="_3-2-the-projection-from-actual-map-and-referee-system" tabindex="-1">3.2 The Projection from Actual Map and Referee System <a class="header-anchor" href="#_3-2-the-projection-from-actual-map-and-referee-system" aria-hidden="true">#</a></h3><p>The manipulator of the sentry will pass a point on the Referee System which is different from position of the real terrain. I used Least Square to calculate the linear projection.</p><p><a href="trimof.github.io/pdf/mpc.pdf" target="_blank">PDF.</a></p>`,67),p=[e];function t(r,c,i,y,C,d){return n(),a("div",null,p)}const F=s(l,[["render",t]]);export{A as __pageData,F as default};
